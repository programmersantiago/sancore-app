<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iniciar Sesión</title>
    <link rel="stylesheet" href="/css/login.css">
    <link th:href="@{/icon/icon2.png}" rel="icon" type="image/x-icon">
</head>

<body>
    <div th:if="${param.error}" class="error-modal">
        <div class="error-content">
            <p>La dirección de correo electrónico o la contraseña faltan o son inválidos. Corríjalo e inténtelo de nuevo.</p>
            <button onclick="closeErrorModal()">Cerrar</button>
        </div>
    </div>
    <div th:if="${message}" th:class="'alert ' + (${status} ?: 'info')" class="alert">
        <span th:text="${message}"></span>
    </div>

    <div class="formulario">

        <h1>Inicio de sesión</h1>
        <form th:action="@{/login}" method="post" onsubmit="return validateForm()" novalidate>

            <div class="username">
                <input type="text" id="username" name="username" placeholder="Correo electrónico o nombre de usuario"
                    required>
            </div>
            <div class="username">
                <input type="password" id="password" name="password" placeholder="Contraseña" required>
            </div>
            <div class="error-message" id="error-message" style="display: none; color: red; margin-bottom: 10px;"></div>
            <div class="recordar">
                <a th:href="@{/forgot-password}">¿Olvidaste tu contraseña?</a>
            </div>
            <button type="submit">Iniciar Sesión</button>
            <div class="registrarse">
                No tienes cuenta? <a th:href="@{/register}">Regístrate aquí.</a>
            </div>
        </form>
    </div>

    <script>
        // JavaScript para validar el formulario
        function validateForm() {
            let username = document.getElementById("username").value;
            let password = document.getElementById("password").value;
            let errorMessage = document.getElementById("error-message");

            if (!username || !password) {
                errorMessage.textContent = "Por favor, complete todos los campos.";
                errorMessage.style.display = "block"; // Mostrar mensaje de error
                return false; // Evita que el formulario se envíe si hay campos vacíos
            }

            errorMessage.style.display = "none"; // Ocultar mensaje de error si todo está correcto
            return true; // Permite que el formulario se envíe
        }

        // Mostrar el mensaje de éxito durante 5 segundos si existe
        document.addEventListener("DOMContentLoaded", function () {
            const messageContainer = document.querySelector('.alert');

            if (messageContainer) {
                messageContainer.style.display = "block"; // Mostrar el mensaje

                // Ocultar el mensaje después de 5 segundos
                setTimeout(() => {
                    messageContainer.style.display = "none";
                }, 4000);
            }
        });

        // Función para cerrar la ventana modal de error
        function closeErrorModal() {
            let errorModal = document.querySelector('.error-modal');
            if (errorModal) {
                errorModal.style.display = 'none';
            }
        }
    </script>

</body>

</html>